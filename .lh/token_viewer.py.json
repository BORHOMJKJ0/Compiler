{
    "sourceFile": "token_viewer.py",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1768914476254,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1768914476254,
            "name": "Commit-0",
            "content": "import tkinter as tk\nfrom tkinter import ttk, messagebox\nfrom antlr4 import *\nfrom lexers.base_lexer import BaseLexer\n\nTOKEN_COLORS = {\n    \"KEYWORD\": \"#f39c12\",\n    \"IDENTIFIER\": \"#3498db\",\n    \"BRACKET_IDENTIFIER\": \"#1abc9c\",\n    \"STRING_SINGLE\": \"#9b59b6\",\n    \"STRING_DOUBLE\": \"#8e44ad\",\n    \"HEX_STRING\": \"#16a085\",\n    \"BIT_STRING\": \"#8e44ad\",\n    \"NUMBER\": \"#27ae60\",\n    \"OPERATOR\": \"#e74c3c\",\n    \"VARIABLE\": \"#e67e22\",\n    \"PUNCTUATION\": \"#34495e\",\n    \"INVALID_IDENTIFIER\": \"#c0392b\",\n    \"LINE_COMMENT\": \"#95a5a6\",\n    \"BLOCK_COMMENT_START\": \"#95a5a6\",\n    \"COMMENT_CONTENT\": \"#95a5a6\",\n    \"WS\": \"#ecf0f1\"\n}\n\n\ndef check_syntax_errors(tokens, lexer, input_text):\n    errors = []\n    warnings = []\n\n    paren_count = 0\n\n    for token in tokens:\n        ttype = lexer.get_token_type_name(token.type)\n        if token.text == '(':\n            paren_count += 1\n        elif token.text == ')':\n            paren_count -= 1\n            if paren_count < 0:\n                errors.append(\n                    f\"Line {token.line}, Column {token.column}: Closing parenthesis ) without opening\")\n                paren_count = 0\n\n        if ttype == \"INVALID_IDENTIFIER\":\n            if token.text.startswith('_') and all(c == '_' for c in token.text):\n                errors.append(\n                    f\"Line {token.line}, Column {token.column}: Invalid identifier '{token.text}' - Cannot use only underscores\")\n            elif token.text[0].isdigit():\n                errors.append(\n                    f\"Line {token.line}, Column {token.column}: Invalid identifier '{token.text}' - Cannot start with digit\")\n            else:\n                errors.append(\n                    f\"Line {token.line}, Column {token.column}: Invalid identifier '{token.text}'\")\n\n        if token.text.startswith('[') and token.text.endswith(']'):\n            if \"'\" in token.text:\n                warnings.append(\n                    f\"Line {token.line}, Column {token.column}: Identifier {token.text} contains single quote\")\n\n        if (token.text.startswith(\"'\") and token.text.endswith(\"'\")) or \\\n                (token.text.startswith('\"') and token.text.endswith('\"')):\n            if \"''\" in token.text[1:-1] or '\"\"' in token.text[1:-1]:\n                warnings.append(\n                    f\"Line {token.line}, Column {token.column}: String contains escaped quotes\")\n\n        # Check for line continuation\n        if ttype in [\"STRING_SINGLE\", \"STRING_DOUBLE\", \"HEX_STRING\", \"BIT_STRING\"]:\n            if '\\\\' in token.text:\n                warnings.append(\n                    f\"Line {token.line}, Column {token.column}: Contains line continuation character\")\n\n    if paren_count > 0:\n        errors.append(f\"Error: {paren_count} unclosed opening parenthesis\")\n\n    comment_depth = 0\n    lines = input_text.split('\\n')\n    for line_num, line in enumerate(lines, 1):\n        i = 0\n        while i < len(line) - 1:\n            if line[i:i + 2] == '/*':\n                comment_depth += 1\n                i += 2\n            elif line[i:i + 2] == '*/':\n                comment_depth -= 1\n                if comment_depth < 0:\n                    errors.append(\n                        f\"Line {line_num}: Closing comment */ without opening /*\")\n                    comment_depth = 0\n                i += 2\n            else:\n                i += 1\n\n    if comment_depth > 0:\n        errors.append(f\"Error: {comment_depth} unclosed block comment\")\n\n    return errors, warnings\n\n\ndef load_tokens(filename=\"testing.sql\"):\n    try:\n        input_text = open(filename, \"r\", encoding=\"utf-8\").read()\n        input_stream = InputStream(input_text)\n    except FileNotFoundError:\n        raise FileNotFoundError(f\"File {filename} not found!\")\n    except Exception as e:\n        raise Exception(f\"Error reading file: {e}\")\n\n    with open(\"sqlInput.txt\", \"r\") as f:\n        input_text = f.read()\n    lexer = BaseLexer(input_text)\n    tokens = lexer.tokenize()\n\n    errors, warnings = check_syntax_errors(tokens, lexer, input_text)\n\n    out = []\n    for t in tokens:\n        ttype = lexer.get_token_type_name(t.type) or \"UNKNOWN\"\n        out.append((t.line, t.column, ttype, t.text))\n\n    return out, errors, warnings\n\n\ndef main():\n    try:\n        tokens, errors, warnings = load_tokens()\n    except FileNotFoundError as e:\n        messagebox.showerror(\"Error\", str(e))\n        return\n    except Exception as e:\n        messagebox.showerror(\"Error\", f\"Analysis error:\\n{str(e)}\")\n        return\n\n    window = tk.Tk()\n    window.title(\"SQL Token Viewer\")\n    window.geometry(\"1200x700\")\n    window.configure(bg=\"#2c3e50\")\n\n    style = ttk.Style(window)\n    style.theme_use(\"default\")\n\n    style.configure(\"Treeview\",\n                    background=\"#ecf0f1\",\n                    foreground=\"#2c3e50\",\n                    rowheight=28,\n                    fieldbackground=\"#ecf0f1\",\n                    font=(\"Consolas\", 10))\n    style.configure(\"Treeview.Heading\",\n                    background=\"#34495e\",\n                    foreground=\"white\",\n                    font=(\"Arial\", 11, \"bold\"))\n    style.map('Treeview', background=[('selected', '#3498db')])\n\n    header_frame = tk.Frame(window, bg=\"#34495e\", height=80)\n    header_frame.pack(fill=tk.X, padx=0, pady=0)\n\n    title_label = tk.Label(header_frame,\n                           text=\"Advanced SQL Lexical Analyzer\",\n                           font=(\"Arial\", 20, \"bold\"),\n                           bg=\"#34495e\",\n                           fg=\"white\")\n    title_label.pack(pady=15)\n\n    if errors or warnings:\n        error_frame = tk.Frame(window, bg=\"#2c3e50\")\n        error_frame.pack(fill=tk.X, padx=10, pady=5)\n\n        if errors:\n            error_label = tk.Label(error_frame,\n                                   text=f\"⚠ Errors: {len(errors)}\",\n                                   font=(\"Arial\", 12, \"bold\"),\n                                   bg=\"#e74c3c\",\n                                   fg=\"white\",\n                                   padx=10,\n                                   pady=5)\n            error_label.pack(side=tk.LEFT, padx=5)\n\n            def show_errors():\n                error_window = tk.Toplevel(window)\n                error_window.title(\"Syntax Errors\")\n                error_window.geometry(\"900x400\")\n                error_window.configure(bg=\"#2c3e50\")\n\n                error_text = tk.Text(error_window,\n                                     font=(\"Consolas\", 10),\n                                     bg=\"#ecf0f1\",\n                                     fg=\"#c0392b\",\n                                     wrap=tk.WORD)\n                error_text.pack(fill=tk.BOTH, expand=True, padx=10, pady=10)\n\n                for error in errors:\n                    error_text.insert(tk.END, f\"✗ {error}\\n\\n\")\n\n                error_text.config(state=tk.DISABLED)\n\n            error_btn = tk.Button(error_frame,\n                                  text=\"Show Errors\",\n                                  command=show_errors,\n                                  bg=\"#c0392b\",\n                                  fg=\"white\",\n                                  font=(\"Arial\", 10, \"bold\"),\n                                  cursor=\"hand2\")\n            error_btn.pack(side=tk.LEFT, padx=5)\n\n        if warnings:\n            warning_label = tk.Label(error_frame,\n                                     text=f\"⚠ Warnings: {len(warnings)}\",\n                                     font=(\"Arial\", 12, \"bold\"),\n                                     bg=\"#f39c12\",\n                                     fg=\"white\",\n                                     padx=10,\n                                     pady=5)\n            warning_label.pack(side=tk.LEFT, padx=5)\n\n            def show_warnings():\n                warning_window = tk.Toplevel(window)\n                warning_window.title(\"Warnings\")\n                warning_window.geometry(\"900x400\")\n                warning_window.configure(bg=\"#2c3e50\")\n\n                warning_text = tk.Text(warning_window,\n                                       font=(\"Consolas\", 10),\n                                       bg=\"#ecf0f1\",\n                                       fg=\"#d68910\",\n                                       wrap=tk.WORD)\n                warning_text.pack(fill=tk.BOTH, expand=True, padx=10, pady=10)\n\n                for warning in warnings:\n                    warning_text.insert(tk.END, f\"⚠ {warning}\\n\\n\")\n\n                warning_text.config(state=tk.DISABLED)\n\n            warning_btn = tk.Button(error_frame,\n                                    text=\"Show Warnings\",\n                                    command=show_warnings,\n                                    bg=\"#d68910\",\n                                    fg=\"white\",\n                                    font=(\"Arial\", 10, \"bold\"),\n                                    cursor=\"hand2\")\n            warning_btn.pack(side=tk.LEFT, padx=5)\n\n    frame = tk.Frame(window, bg=\"#2c3e50\")\n    frame.pack(fill=tk.BOTH, expand=True, padx=10, pady=10)\n\n    tree = ttk.Treeview(frame,\n                        columns=(\"line\", \"col\", \"type\", \"value\"),\n                        show=\"headings\",\n                        selectmode=\"browse\")\n\n    tree.heading(\"line\", text=\"Line\")\n    tree.heading(\"col\", text=\"Column\")\n    tree.heading(\"type\", text=\"Token Type\")\n    tree.heading(\"value\", text=\"Value\")\n\n    tree.column(\"line\", width=80, anchor=\"center\")\n    tree.column(\"col\", width=80, anchor=\"center\")\n    tree.column(\"type\", width=200, anchor=\"w\")\n    tree.column(\"value\", width=700, anchor=\"w\")\n\n    vsb = ttk.Scrollbar(frame, orient=\"vertical\", command=tree.yview)\n    hsb = ttk.Scrollbar(frame, orient=\"horizontal\", command=tree.xview)\n    tree.configure(yscroll=vsb.set, xscroll=hsb.set)\n\n    tree.grid(row=0, column=0, sticky=\"nsew\")\n    vsb.grid(row=0, column=1, sticky=\"ns\")\n    hsb.grid(row=1, column=0, sticky=\"ew\")\n    frame.grid_rowconfigure(0, weight=1)\n    frame.grid_columnconfigure(0, weight=1)\n\n    for line, col, ttype, value in tokens:\n        display_value = value if len(value) <= 100 else value[:97] + \"...\"\n        tree.insert(\"\", \"end\", values=(\n            line, col, ttype, display_value), tags=(ttype,))\n\n    for ttype, color in TOKEN_COLORS.items():\n        tree.tag_configure(ttype, foreground=color)\n\n    status_frame = tk.Frame(window, bg=\"#34495e\")\n    status_frame.pack(side=tk.BOTTOM, fill=tk.X)\n\n    token_stats = {}\n    for _, _, ttype, _ in tokens:\n        token_stats[ttype] = token_stats.get(ttype, 0) + 1\n\n    stats_text = f\"Total Tokens: {len(tokens)}\"\n    if errors:\n        stats_text += f\"  |  Errors: {len(errors)}\"\n    if warnings:\n        stats_text += f\"  |  Warnings: {len(warnings)}\"\n\n    status_left = tk.Label(status_frame,\n                           text=stats_text,\n                           bd=1,\n                           relief=tk.FLAT,\n                           anchor=tk.W,\n                           bg=\"#34495e\",\n                           fg=\"white\",\n                           font=(\"Arial\", 10),\n                           padx=10)\n    status_left.pack(side=tk.LEFT, fill=tk.X, expand=True)\n\n    def show_stats():\n        stats_window = tk.Toplevel(window)\n        stats_window.title(\"Token Statistics\")\n        stats_window.geometry(\"500x600\")\n        stats_window.configure(bg=\"#2c3e50\")\n\n        title = tk.Label(stats_window,\n                         text=\"Token Type Distribution\",\n                         font=(\"Arial\", 16, \"bold\"),\n                         bg=\"#34495e\",\n                         fg=\"white\",\n                         pady=10)\n        title.pack(fill=tk.X)\n\n        stats_frame = tk.Frame(stats_window, bg=\"#ecf0f1\")\n        stats_frame.pack(fill=tk.BOTH, expand=True, padx=20, pady=20)\n\n        for i, (ttype, count) in enumerate(sorted(token_stats.items(), key=lambda x: -x[1])):\n            color = TOKEN_COLORS.get(ttype, \"#2c3e50\")\n\n            row_frame = tk.Frame(stats_frame, bg=\"#ecf0f1\", pady=5)\n            row_frame.pack(fill=tk.X)\n\n            type_label = tk.Label(row_frame,\n                                  text=ttype,\n                                  font=(\"Consolas\", 11),\n                                  bg=\"#ecf0f1\",\n                                  fg=color,\n                                  width=25,\n                                  anchor=\"w\")\n            type_label.pack(side=tk.LEFT)\n\n            count_label = tk.Label(row_frame,\n                                   text=str(count),\n                                   font=(\"Arial\", 11, \"bold\"),\n                                   bg=\"#ecf0f1\",\n                                   fg=\"#2c3e50\")\n            count_label.pack(side=tk.RIGHT)\n\n    stats_btn = tk.Button(status_frame,\n                          text=\"Show Statistics\",\n                          command=show_stats,\n                          bg=\"#3498db\",\n                          fg=\"white\",\n                          font=(\"Arial\", 9, \"bold\"),\n                          cursor=\"hand2\",\n                          padx=15,\n                          pady=3)\n    stats_btn.pack(side=tk.RIGHT, padx=10, pady=5)\n\n    if not errors:\n        success_label = tk.Label(status_frame,\n                                 text=\"✓ Analysis Successful\",\n                                 bg=\"#27ae60\",\n                                 fg=\"white\",\n                                 font=(\"Arial\", 10, \"bold\"),\n                                 padx=15,\n                                 pady=3)\n        success_label.pack(side=tk.RIGHT, padx=5, pady=5)\n\n    window.mainloop()\n\n\nif __name__ == \"__main__\":\n    main()\n"
        }
    ]
}