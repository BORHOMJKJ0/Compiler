{
    "sourceFile": "AST_NULL_ANALYSIS.md",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1769013310040,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1769013310040,
            "name": "Commit-0",
            "content": "# AST NULL VALUES - Complete Analysis Report\n\n## Test Results Summary\n\n**Date:** January 21, 2026  \n**Test Files:** 4 SQL files (train.sql, train2.sql, testing.sql, full_sql_test.sql)  \n**Total SQL Statements Parsed:** 41  \n**Statements with Nulls:** 30 (73.2%)  \n**Total Null Occurrences:** 237  \n**Unique Null Field Paths:** 53  \n\n---\n\n## Critical Issues ❌\n\n### Issue 1: UPDATE Statement Expressions Not Being Built (testing.sql)\n**Severity:** CRITICAL  \n**Count:** 4 null expressions, 4 null operators\n\n```\nassignmentList[0].expression: null  ← Should contain the SET value\noperator: null (4 instances)        ← Operators not captured in conditions\n```\n\n**Example from testing.sql (Statement 2):**\n```sql\nUPDATE FACT1\nSET [KEY1'S] = CASE WHEN KEY2 = 4 OR KEY3 IN (1,7) THEN 1 ... END\nWHERE [KEY1'S] IS NULL\n```\n**Problem:** The CASE expression and operators (=, OR, IN) are not being captured in the AST\n\n**Files Affected:**\n- testing.sql: UPDATE statements with complex expressions\n\n---\n\n### Issue 2: FROM Clause Missing Data (train.sql, train2.sql)\n**Severity:** HIGH  \n**Count:** 17 instances each of keyword, identifier, and schema\n\n```\nfromClause.tableSource[0].keyword: null      ← \"FROM\" keyword not stored (17x)\nfromClause.tableSource[0].identifier: null   ← Table alias not captured (17x)\nfromClause.tableSource[0].tableName.schema: null ← Schema always null (16x)\n```\n\n**Examples:**\n```sql\nFROM products              ← No schema, no alias\nFROM dbo.TRACKING          ← Schema \"dbo\" not captured\nFROM sys.columns           ← Schema \"sys\" not captured\nFROM products AS p         ← Alias \"p\" not captured\n```\n\n**Files Affected:**\n- train.sql: Most FROM clauses missing schema/alias/keyword\n- train2.sql: Same issue\n- testing.sql: Same issue\n\n---\n\n### Issue 3: INSERT Statement Incomplete (train2.sql)\n**Severity:** HIGH  \n**Count:** 1 instance each\n\n```\ninsertColumns: null      ← Column list not parsed\ninsertValues: null       ← VALUES clause not parsed\nselectStatement: null    ← INSERT...SELECT not recognized\n```\n\n**Example from train2.sql:**\n```sql\nINSERT INTO TRACKING (\n    [TRACKING_KEY],\n    [C_KEY],\n    [USER_KEY],\n    ...\n)\nVALUES (...)\n```\n**Problem:** Column list and VALUES clause not being extracted\n\n---\n\n## Expected/Normal Nulls ✓\n\nThese nulls are **CORRECT** - they represent optional SQL clauses:\n\n| Field | Count | Expected | Reason |\n|-------|-------|----------|--------|\n| `orderByClause` | 15 | YES | ORDER BY is optional |\n| `whereClause` | 10 | YES | WHERE is optional |\n| `table_name` | 25+ | YES | Only set for qualified columns (table.col) |\n| `keywordAs` | 16 | YES | Only present when alias used |\n| `identifier` (alias) | 16 | YES | Only present when alias used |\n| `selectStatement.keywordAs` | 4 | YES | Subquery aliases optional |\n| `keyword2` (constraints) | 3 | YES | Second part of constraint optional |\n\n---\n\n## Detailed Breakdown by File\n\n### train.sql - SELECT Statements\n**Stats:**\n- Total: 25 statements\n- With nulls: 17 (68%)\n- Total nulls: 173\n\n**Issues Found:**\n1. **FROM clause incomplete (16 instances)**\n   - Schema always null\n   - Keyword not stored\n   - Alias not captured\n\n2. **ORDER BY/WHERE optional (expected)**\n   - orderByClause: 14 nulls (expected - ORDER BY optional)\n   - whereClause: 8 nulls (expected - WHERE optional)\n\n3. **Column aliases optional (expected)**\n   - keywordAs: 15 nulls (expected - aliases optional)\n   - identifier: 15 nulls (expected - aliases optional)\n\n**Top null fields (problematic):**\n- fromClause.tableSource[0].keyword: 16\n- fromClause.tableSource[0].identifier: 16\n- fromClause.tableSource[0].tableName.schema: 16\n\n---\n\n### train2.sql - IF EXISTS and INSERT\n**Stats:**\n- Total: 2 statements\n- With nulls: 2 (100%)\n- Total nulls: 13\n\n**Issues Found:**\n\n**Statement 0 (IF EXISTS):**\n```json\n{\n  \"selectStatement\": {\n    \"selectList[0].keywordAs\": null,\n    \"selectList[0].identifier\": null,\n    \"orderByClause\": null,\n    \"whereClause.condition.table_name\": null,\n    \"fromClause.tableSource[0].keyword\": null,\n    \"fromClause.tableSource[0].identifier\": null,\n    \"fromClause.tableSource[0].tableName.schema\": null\n  },\n  \"blockStatement\": null\n}\n```\n- **From clause issues:** keyword, identifier, schema not captured\n- **Block statement:** NULL (IF...BEGIN block not parsed)\n\n**Statement 1 (INSERT):**\n```json\n{\n  \"tableName.schema\": null,\n  \"insertColumns\": null,\n  \"insertValues\": null,\n  \"selectStatement\": null,\n  \"execStatement\": null\n}\n```\n- **Critical:** Column list not parsed\n- **Critical:** VALUES clause not parsed\n- **Schema:** Not extracted from table name\n\n---\n\n### testing.sql - Complex Statements\n**Stats:**\n- Total: 14 statements\n- With nulls: 11 (78.6%)\n- Total nulls: 51\n\n**Issues Found:**\n\n**Critical Issues:**\n1. **operator: null (4 instances)**\n   - Binary operators in conditions not captured\n   - Operators like =, OR, IN, IN not in AST\n\n2. **expression: null (4 instances)**\n   - Some expressions not being built\n   - Probably in UPDATE/INSERT statements\n\n**File-specific issues:**\n- Testing.sql Statement 2 (UPDATE): assignmentList[0].expression = null\n  ```sql\n  UPDATE FACT1 SET [KEY1'S] = CASE ... END\n  WHERE [KEY1'S] IS NULL\n  ```\n  The CASE expression and conditions not captured\n\n- Testing.sql Statement 0 (CREATE TABLE): constraints keyword2 = null (3x)\n  ```sql\n  [DIAGNOSIS_KEY'1] [int] NOT NULL\n  ```\n  Second constraint keyword not captured\n\n---\n\n## Root Causes & Fixes Needed\n\n### Fix 1: Update Statement Builder\n**File:** `builders/statement_builder.py`  \n**Method:** `build_update_statement` or `build_assignment`\n\n**Current Problem:**\n```python\n# Probably not calling build_expression on assignment values\n```\n\n**Fix Needed:**\n```python\ndef build_assignment(self, ctx):\n    # MUST extract and build the expression for the value\n    # Currently it's probably returning None/empty\n    expression = self.expr_builder.build_expression(ctx.expression())\n    operator = ctx.getChild(0).getText() if ctx.getChildCount() > 0 else None\n    return AssignmentNode(column=..., expression=expression, operator=operator)\n```\n\n---\n\n### Fix 2: FROM Clause Builder\n**File:** `builders/statement_builder.py`  \n**Method:** `build_from_clause`, `build_table_source`\n\n**Current Problem:**\n```python\n# Not capturing: keyword, schema, alias\n```\n\n**Fix Needed:**\n```python\ndef build_table_source(self, ctx):\n    # Must extract:\n    # 1. Keyword (FROM)\n    tableName = self.extract_table_name_with_schema(ctx.tableName())\n    # 2. Schema from qualifiedName\n    schema = extract_schema_if_present(tableName)\n    # 3. Alias if present\n    alias = ctx.identifier().getText() if ctx.identifier() else None\n    \n    return TableSourceNode(\n        name=tableName.name,\n        schema=schema,      # ← Currently always null\n        keyword=None,       # ← Should be \"FROM\"\n        identifier=alias    # ← Currently always null\n    )\n```\n\n---\n\n### Fix 3: INSERT Statement Builder  \n**File:** `builders/statement_builder.py`  \n**Method:** `build_insert_statement`\n\n**Current Problem:**\n```python\n# insertColumns and insertValues probably returning None\n# INSERT...SELECT not recognized\n```\n\n**Fix Needed:**\n```python\ndef build_insert_statement(self, ctx):\n    # Must extract:\n    # 1. Column list from insertColumns()\n    columns = self.extract_column_list(ctx.insertColumns()) if ctx.insertColumns() else None\n    # 2. VALUES from insertValues()\n    values = self.extract_values(ctx.insertValues()) if ctx.insertValues() else None\n    # 3. Or SELECT statement\n    select = self.build_select(ctx.selectStatement()) if ctx.selectStatement() else None\n    \n    return InsertStatementNode(\n        tableName=...,\n        insertColumns=columns,    # ← Currently None\n        insertValues=values,      # ← Currently None  \n        selectStatement=select    # ← Currently None\n    )\n```\n\n---\n\n### Fix 4: Expression Builder - Operators\n**File:** `builders/expression_builder.py`  \n**Method:** `build_expression`\n\n**Current Problem:**\n```python\n# Not handling all operator types\n# Binary operators not captured\n```\n\n**Fix Needed:**\n```python\ndef build_expression(self, ctx):\n    # Ensure all operators are captured:\n    # 1. Binary operators (=, <>, <, >, <=, >=, LIKE, IN, AND, OR)\n    # 2. Unary operators (NOT, -)\n    \n    operator = self.extract_operator(ctx)\n    left = self.build_expression(ctx.left)\n    right = self.build_expression(ctx.right)\n    \n    return BinaryExpressionNode(\n        left=left,\n        operator=operator,  # ← Must not be None\n        right=right\n    )\n```\n\n---\n\n## Summary Table\n\n| Issue | Severity | Count | File(s) | Status |\n|-------|----------|-------|---------|--------|\n| FROM clause keyword/schema/alias missing | HIGH | 50 | all | ❌ UNFIXED |\n| UPDATE expression/operator missing | CRITICAL | 8 | testing.sql | ❌ UNFIXED |\n| INSERT columns/values missing | HIGH | 3 | train2.sql | ❌ UNFIXED |\n| Optional clauses null | NORMAL | 100+ | all | ✓ EXPECTED |\n\n---\n\n## Test Files Generated\n1. `test_all_sql_files.py` - Comprehensive null analysis tool\n2. `NULL_ANALYSIS_REPORT.md` - Detailed analysis\n3. `NULL_SUMMARY.md` - Quick summary\n4. `null_analysis.txt` - Test output\n5. `AST_NULL_ANALYSIS.md` - This report\n"
        }
    ]
}