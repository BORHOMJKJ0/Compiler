{
    "sourceFile": "testing.sql",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1764237529880,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1764238396991,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -47,9 +47,9 @@\n END\r\n GO\r\n \r\n \r\n-DECLARE @ErrorMessage         NVARCHAR(4000)          \r\n+DECLARE @ErrorMessage         NVARCHAR('4000)          \r\n DECLARE @ErrorState           INT          \r\n DECLARE @ErrorSeverity        INT \r\n \r\n /* DROP CONSTARINTS */\r\n"
                }
            ],
            "date": 1764237529880,
            "name": "Commit-0",
            "content": "CREATE TABLE [dbo].[DIAGNOSIS](\r\n\t[DIAGNOSIS_KEY'1] [int] NOT NULL,\r\n\t[DIAGNOSIS_NAME] [nvarchar](300) NOT NULL,\r\n\t[DIAGNOSIS_CATEGORY_KEY] [int] NULL\r\n\t)\r\n\r\nIF NOT EXISTS (\r\n    SELECT 1 FROM sys.columns\r\n    WHERE Name = 'KEY1''S'\r\n      AND Object_ID = Object_ID('FACT1')\r\n)\r\nBEGIN\r\n\t\tALTER TABLE FACT1 \r\n        ADD [KEY1'S] INT NULL;\r\nEND\r\nGO\r\n\r\nUPDATE FACT1\r\nSET [KEY1'S] =\r\n    CASE \r\n        WHEN KEY2 = 4 OR KEY3 IN (1,7) THEN 1\r\n        WHEN KEY5 = 2 THEN 2\r\n        ELSE 0\r\n    END\r\nWHERE [KEY1'S] IS NULL;\r\nGO\r\n\r\nIF NOT EXISTS (\r\n    SELECT 1 FROM sys.columns \r\n    WHERE Name = 'HASH2' \r\n      AND Object_ID = Object_ID('FACT_2')\r\n)\r\nBEGIN\r\n    ALTER TABLE FACT_2 \r\n    ADD HASH2 BIGINT NULL;\r\nEND\r\nGO\r\n\r\nIF NOT EXISTS (\r\n    SELECT 1 FROM sys.columns \r\n    WHERE Name = 'DIAGNOSIS_KEY''1' \r\n      AND Object_ID = Object_ID('FACT_2')\r\n)\r\nBEGIN\r\n    ALTER TABLE FACT_2 \r\n    ADD [DIAGNOSIS_KEY'1] INT NULL;\r\nEND\r\nGO\r\n\r\n\r\nDECLARE @ErrorMessage         NVARCHAR(4000)          \r\nDECLARE @ErrorState           INT          \r\nDECLARE @ErrorSeverity        INT \r\n\r\n/* DROP CONSTARINTS */\r\ndeclare @sql_drop_constarints nvarchar(max)\r\nset @sql_drop_constarints = ''\r\n\r\nSELECT @sql_drop_constarints += N'\r\nALTER TABLE ' + QUOTENAME(OBJECT_SCHEMA_NAME(parent_object_id))\r\n    + '.' + QUOTENAME(OBJECT_NAME(parent_object_id)) + \r\n    ' DROP CONSTRAINT ' + QUOTENAME(name) + ';' \r\nFROM sys.foreign_keys;\r\n\r\nBEGIN TRY\r\nEXEC sp_executesql @sql_drop_constarints;\r\nEND TRY\r\nBEGIN CATCH\r\n\r\n    --Obtain the error message, severity and state      \r\n    SELECT @ErrorMessage = ERROR_MESSAGE(), @ErrorSeverity = ERROR_SEVERITY(), @ErrorState = ERROR_STATE()      \r\n    --RAISERROR (@ErrorMessage, @ErrorSeverity, @ErrorState)         \r\nEND CATCH\r\n\r\n\r\n/* DROP ALL TABLES EXECPT \r\n/* DROP ALL TABLES EXECPT \r\n*/\r\n*/\r\nDECLARE @sql_drop_tables NVARCHAR(max)=''\r\n\r\nSELECT @sql_drop_tables += ' Drop table ' + QUOTENAME(TABLE_SCHEMA) + '.'+ QUOTENAME(TABLE_NAME) + '; '\r\nFROM   INFORMATION_SCHEMA.TABLES\r\nWHERE  TABLE_TYPE = 'BASE TABLE'\r\nAND TABLE_NAME NOT IN ('FACT1', 'fact2', 'Fact3' )\r\n\r\nExec Sp_executesql @sql_drop_tables\r\n\r\nBEGIN TRY\r\nEXEC sp_executesql @sql_drop_tables;\r\nEND TRY\r\nBEGIN CATCH\r\n    --Obtain the error message, severity and state      \r\n    SELECT @ErrorMessage = ERROR_MESSAGE(), @ErrorSeverity = ERROR_SEVERITY(), @ErrorState = ERROR_STATE()      \r\n    --RAISERROR (@ErrorMessage, @ErrorSeverity, @ErrorState)         \r\nEND CATCH\r\n\r\n"
        }
    ]
}